<!DOCTYPE html>
<html>
  <head>
    <title>AWS REST wrapped around WCF - Front to Back – The World o' Curtis Mavis – Code, Music, Kids, Sleep</title>

        <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="Last post I laid out some reasons for using AWS API Gateway for creating REST services.  In this post, I’d like to walk some of the pieces involved, both within AWS, as well as some external tools that can take it to the next level.  In order to cover all the things, I’m going to paint a high level picture, with links to pages providing more detail.
" />
    <meta property="og:description" content="Last post I laid out some reasons for using AWS API Gateway for creating REST services.  In this post, I’d like to walk some of the pieces involved, both within AWS, as well as some external tools that can take it to the next level.  In order to cover all the things, I’m going to paint a high level picture, with links to pages providing more detail.
" />
    
    <meta name="author" content="The World o' Curtis Mavis" />

    
    <meta property="og:title" content="AWS REST wrapped around WCF - Front to Back" />
    <meta property="twitter:title" content="AWS REST wrapped around WCF - Front to Back" />
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-75390437-1', 'auto');
  ga('send', 'pageview');

</script>

    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="alternate" type="application/rss+xml" title="The World o' Curtis Mavis - Code, Music, Kids, Sleep" href="/feed.xml" />
    <link rel="shortcut icon" type="image/png" href="/images/favicon.png">
    <!-- Created with Jekyll Now - http://github.com/barryclark/jekyll-now -->
  </head>

  <body>
    <div class="wrapper-masthead">
      <div class="container">
        <header class="masthead clearfix">
          <a href="/jongriffin" class="site-avatar"><img src="/images/Curtis.png" /></a>

          <div class="site-info">
            <h1 class="site-name"><a href="/">The World o' Curtis Mavis</a></h1>
            <p class="site-description">Code, Music, Kids, Sleep</p>
          </div>

          <nav>
            <a href="/">Blog</a>
            <a href="/about">About</a>
          </nav>
        </header>
      </div>
    </div>

    <div id="main" role="main" class="container">
      <article class="post">

	<div class="social-button">
		<a href="https://twitter.com/share" class="twitter-share-button" data-text="AWS REST wrapped around WCF - Front to Back" data-via="MartyIce" data-size="large">Tweet</a>
		<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
  </div>
  <br />
  <div style="margin-top: 10px"/>
	<div class="social-button" >
    <script src="https://platform.linkedin.com/in.js" type="text/javascript">lang: en_US</script>
    <script type="IN/Share" data-url="http://localhost:4000/aws-rest-wrapped/"></script>
  </div>

  <h1>AWS REST wrapped around WCF - Front to Back</h1>

  <div class="entry">
    <p>Last post I laid out some reasons for using <a target="_blank" href="https://aws.amazon.com/api-gateway">AWS API Gateway</a> for creating REST services.  In this post, I’d like to walk some of the pieces involved, both within AWS, as well as some external tools that can take it to the next level.  In order to cover all the things, I’m going to paint a high level picture, with links to pages providing more detail.</p>

<h2 id="aws-overview">AWS Overview</h2>

<p>First, setup within AWS.  The basic layout for a REST service within the AWS API Gateway is:</p>

<ul>
  <li><strong>APIs</strong> - overall container for a single API (in our implementation, “Dev”, “Prd”, “Sandbox” each get their own API)
    <ul>
      <li><strong>Resources</strong> - entities exposed by the REST API, eg “Reservation”, “Account”, etc.  Resources define source endpoints, mappings, and security.</li>
      <li><strong>Stages</strong> - deployment/snapshots of a Resource.  Once your Resource has been defined, you deploy a (publicly available) Stage.  For our implementation, we followed the convention of versioning in the Stage path (eg “myResource/v1/<id>").  AWS exposes a (lengthy) URI for your Stage (eg,  https://xxxxxxxxxx.execute-api.us-west-2.amazonaws.com/v1), which can be invoked from the internets.</id></li>
      <li><strong>Custom Authorizers</strong> - these provide a variety of access control mechanisms to your REST endpoints, such as OAuth and SAML.</li>
      <li><strong>Models</strong> - these can be used to define the payload of the various REST endpoints, and are mainly used by mapping templates (more on mapping templates in a minute, they allow you to transform inputs/outputs from the AWS REST layer to your internal layer).  They’re also referenced by Lambda functions (more on those below as well).  Honestly, we didn’t use these much - we aren’t using Lambdas, and wrote most of the transformation templates by hand.</li>
    </ul>
  </li>
</ul>

<p>Amazon provides thorough documentation around this whole thing, including this informative <a target="_blank" href="http://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-create-api-from-example.html">walkthrough</a>.  There are a variety of other wikis/blogs out there that illustrate this process, Googling turns up plenty.</p>

<h2 id="outside-in">Outside In</h2>

<p>With all the above configured, you have two options for your “internal” services:</p>

<ol>
  <li>Provide existing endpoints that AWS invokes from the REST endpoints (this is the method we are using).</li>
  <li>Use <a target="_blank" href="https://aws.amazon.com/lambda/">AWS Lambda</a> functions.  These are dynamic services you define entirely within AWS (using languages such as JS, Python, Java, etc), and look pretty powerful.  We already have web services we want to utilize, so this option wasn’t really considered; however, it appears a person could do some pretty fantastic things with them.</li>
</ol>

<p>With each option above, the AWS API Gateway enables transformation of payloads, both inbound and outbound, using <a target="_blank" href="https://velocity.apache.org/engine/releases/velocity-1.5/user-guide.html">VTL Mapping Templates</a>.  VTL was pretty easy to understand, but limited in functionality (compared to something like JS).  I’m assuming its more performant, but it would be nice to see more capabilities added here in the future.</p>

<h2 id="swagger">Swagger</h2>

<p>Once everything has been setup in AWS, there is a super cool option of exporting your Stage into a <a target="_blank" href="http://swagger.io/">Swagger</a> file.</p>

<p><img src="/images/AWSAPIExport.png" /></p>

<p>This is sort of the JSON equivalent of what XSD provides for XML, but simpler (as a side note, a developer on our team who is VERY particular about rigidly defining and documenting services scorns Swagger/REST/JSON, because of the “loose” definitions.  I personally am OK with the tradeoff, but recognize there is probably potential for ambiguity, confusion, etc).</p>

<p>With this Swagger file in hand, you now have an easy path to setting up Documentation, an SDK sandbox, and Postman tests!</p>

<h2 id="documentation--sandbox">Documentation / Sandbox</h2>

<p>One of the biggest challenges with supporting an external API is teaching people how to use it, and keeping that documentation up to date.  One benefit to Swagger is you can use <a target="_blank" href="http://swagger.io/swagger-ui/">Swagger UI</a>, a tool that automatically generates documentation and a sandbox from a Swagger file.  It is dead simple to get up and running, and the open-sourceness of it allows for tweaking generated content to your heart’s content (/ˈkäntent/, /kənˈtent/).</p>

<p>Here’s a screenshot of the their default example.  As you can see, it provides a high level list of all the resources available in the Swagger definition:</p>

<p><img src="/images/swaggerUI1.png" /></p>

<p>From here, a user can drill down into the operations available on each Resource:</p>

<p><img src="/images/swaggerUI2.png" /></p>

<p>And for each operation, they can drill deeper, view detailed documentation, and even test them against a sandbox.  Huge potential for professional SDK generation here!</p>

<p><img src="/images/swaggerUI3.png" /></p>

<p>As long as the Swagger file is the source of truth, and is kept current, Swagger UI can drastically reduce friction for external consumption of a REST API.</p>

<h2 id="postman">Postman</h2>

<p>One mental shift I’ve had to make in the past few years is when creating “pure” services, I no longer need a client app.  In the days when a client app was part of the delivery, that’s what we used to test functionality.  When a service was the only delivery, I would usually create some sort of throwaway GUI to test functionality.  However, recently I’ve been using <a target="_blank" href="https://www.getpostman.com/">Postman</a> to test services, and love it.</p>

<p>Postman invokes any sort of web endpoint, and allows for configuration of headers, payloads, security, etc.  Additionally, they are continuing to add other functionality on top of these primitives, such as environment management to enable variable sets (eg, “development” variables vs “qa” variables), test scripts to validate results (and populate environment variables), and importing/exporting suites to foster collaboration.</p>

<p>Postman seems to fall short when it comes to “composite” operations, where you’re trying to test a series of web calls end-to-end.  A recent update offers the ability to chain different calls together, so it looks like they’re looking to improve this?  However, if you need complex coordination between a series of web service calls, you either need to manually coordinate them, or fallback to a custom test harness.</p>

<p>With regards to Swagger and AWS, Postman offers the capability of importing Swagger files, and generating a series of tests from it.  This means that once your API has been staged in AWS, you can quickly spin up test invocations from Postman.  Very slick, very powerful.</p>

<p><img src="/images/PostmanImport.png" /></p>

<h2 id="postscript">Postscript</h2>

<p>I hope I’ve done a decent job of illustrating possibilities with the AWS API architecture, and describing tools that multiply its power.  It’s worth noting that we are in the initial stages of using these ourselves (first consumer is currently in the testing phase), so we will continue to learn and grow.  But so far, we’re really excited about the potential!</p>

<p>…And now, the moment you’ve all been waiting for, this week’s “What Did Marty Learn About Blogging and The Web” (better known as “WDMLABATW”):</p>

<aside class="full-aside">
	<h3>WDMLABATW of the week(s):</h3>
	<ul class="padded-li">
		<li>Longer, more detailed posts take more time!  I know that you, my rabid readers, have been wondering about the next post, and I hope I haven't brought too much sadness into your lives with this delay.  In addition to the longer time actually writing, its harder to stay motivated between writing sessions.  This one sat untouched for days on end, and I'd get depressed just thinking about it.  Kind of a slog!  I suspect the secret here is taking it in smaller bites, being OK with yourself when you need a few days off, and steadily marching forward.  I think/hope this type of thing will get easier with time.</li>
		<li>I've got a Tweet button!  I wanted to get this in place, and like I said, this post took longer than I would have liked, so I did this rather quickly. Twitter <a target="_blank" href="https://about.twitter.com/resources/buttons#tweet">makes it easy</a>.  I plan on making this more robust and complete in the future.
		</li>
	</ul>
</aside>


  </div>

  <div class="date">
    Written on April 29, 2016
  </div>

  
<div class="comments">
	<div id="disqus_thread"></div>
	<script type="text/javascript">

	    var disqus_shortname = 'martymavis';

	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();

	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

</article>

    </div>

    <div class="wrapper-footer">
      <div class="container">
        <footer class="footer">
          
<a href="mailto:marty.mavis@gmail.com"><i class="svg-icon email"></i></a>
<a href="https://www.facebook.com/MartyIce"><i class="svg-icon facebook"></i></a>

<a href="https://github.com/MartyIce"><i class="svg-icon github"></i></a>

<a href="https://www.linkedin.com/in/martymavis"><i class="svg-icon linkedin"></i></a>


<a href="https://www.twitter.com/MartyIce"><i class="svg-icon twitter"></i></a>
<a href="http://stackoverflow.com/users/18453/marty"><i class="svg-icon stackoverflow"></i></a>
<a href="https://youtube.com/user/CurtisMavis"><i class="svg-icon youtube"></i></a>

        </footer>
      </div>
    </div>

    
  </body>
</html>
